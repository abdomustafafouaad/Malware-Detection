from os import listdir,kill
from os.path import isfile, join
import time
import signal
proc_aloc = {}
chang = {}
flag = 0
flag2 = 0
while True :
    for proc in listdir("/proc/"):
        if proc.isnumeric() :
            size = 0
            s = "/proc/"+str(proc)+"/maps"
            f = open(s , "r")
            for line in f:
                if flag == 1 and "-" in line:
                    size = int(size)+ int(line[line.find("-")+1:line.find(" ")],16) - int(line[0:line.find("-")], 16)
                    flag =0
                elif "heap" in line:
                    flag = 1
                    flag2 =1
                    size = int(size)+ int(line[line.find("-")+1:line.find(" ")],16) - int(line[0:line.find("-")], 16)
            # print (proc_aloc)
            if flag2 ==1:

                if   not proc in  proc_aloc :
                    proc_aloc[proc] =size
                    chang[proc] = "0"
                x = proc_aloc[proc]
                # print( type(x),x)
                if 150000000 + x < size:
                    chang[proc] =  str(int(chang[proc])+1)
                    proc_aloc[proc] =size
                elif proc_aloc[proc]>(150*1000*1000)+size:
                    chang[proc] =  str(int(chang[proc])+1)
                    proc_aloc[proc] =size

                else:
                    proc_aloc[proc] = size   
            flag2 = 0
    time.sleep(1)
    for pro in chang:
        if int(chang[pro])>=8:
            print (pro)
            print (chang[pro])
            try:
                kill(int(pro), signal.SIGTERM)
                chang[pro] = "0"
            except:
                continue
